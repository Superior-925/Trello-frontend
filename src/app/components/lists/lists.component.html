<nav class="navbar navbar-light bg-light search-form">
  <div class="container-fluid">
    <form class="d-flex form-group" [formGroup]="searchTaskForm" novalidate (ngSubmit)="searchTask(searchTaskForm.value.taskTitle, searchTaskForm)">
      <div class="form-group">
      <input class="form-control me-2" type="search" formControlName="taskTitle" placeholder="Enter the title of the task" aria-label="Search">
      </div>
      <div class="form-group search-button">
        <button class="btn btn-outline-success" type="submit" data-bs-toggle="modal" data-bs-target="#myModal" [disabled]="searchTaskForm.invalid">Search</button>
      </div>
    </form>
  </div>
</nav>

<div cdkDropListGroup>
<div class="wrapper">

    <div class="list-item ">
      <div class="list-title d-flex justify-content-center">
        {{todoList}}
      </div>
      <div class="dividing-line"></div>

      <div class="draggable-container">
        <div
          cdkDropList
          [cdkDropListData]="todoListTasks"
          class="draggable-list"
          (cdkDropListDropped)="drop($event)">
          <div class="draggable-box" *ngFor="let item of todoListTasks" cdkDrag>
            <div class="task-wrapper">
              <div class="form-group">
                <div class="task-title">Task title:<input type="text" class="form-control" [(ngModel)]="item.taskTitle" (change)="renameTaskTitleOrText(item.taskId, item.taskTitle, null)"/></div>
                <div class="task-text">Task text:<input type="text" class="form-control" [(ngModel)]="item.taskText" (change)="renameTaskTitleOrText(item.taskId, null, item.taskText)"/></div>
              </div>
              <div class="options-block">
                <button type="button" class="btn btn-primary btn-sm delete-task-button" (click)="deleteTask(item.taskId)">Delete task</button>
                <button type="button" class="btn btn-secondary btn-sm">Tap me</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addTaskStatusTodoList; then addTaskButtonTodoList else inputTaskFormTodoList"></div>
      <div class="list-options">
        <button type="button" class="btn btn-primary btn-sm" (click)="deleteAllTasks(todoListTasks)">Delete all tasks</button>
      </div>
    </div>

    <div class="list-item">
      <div class="list-title d-flex justify-content-center">
        {{inProgressList}}
      </div>
      <div class="dividing-line"></div>

      <div class="draggable-container">
        <div
          cdkDropList
          [cdkDropListData]="inProgressListTasks"
          class="draggable-list"
          (cdkDropListDropped)="drop($event)">
          <div class="draggable-box" *ngFor="let item of inProgressListTasks" cdkDrag>
            <div class="task-wrapper">
              <div class="form-group">
                <div class="task-title">Task title:<input type="text" class="form-control" [(ngModel)]="item.taskTitle" (change)="renameTaskTitleOrText(item.taskId, item.taskTitle, null)"/></div>
                <div class="task-text">Task text:<input type="text" class="form-control" [(ngModel)]="item.taskText" (change)="renameTaskTitleOrText(item.taskId, null, item.taskText)"/></div>
              </div>
              <div class="options-block">
                <button type="button" class="btn btn-primary btn-sm delete-task-button" (click)="deleteTask(item.taskId)">Delete task</button>
                <button type="button" class="btn btn-secondary btn-sm">Tap me</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addTaskStatusProgressList; then addTaskButtonProgressList else inputTaskFormProgressList"></div>
      <div class="list-options">
        <button type="button" class="btn btn-primary btn-sm" (click)="deleteAllTasks(inProgressListTasks)">Delete all tasks</button>
      </div>
    </div>

    <div class="list-item">
      <div class="list-title d-flex justify-content-center">
        {{codedList}}
      </div>
      <div class="dividing-line"></div>

      <div class="draggable-container">
        <div
          cdkDropList
          [cdkDropListData]="codedListTasks"
          class="draggable-list"
          (cdkDropListDropped)="drop($event)">
          <div class="draggable-box" *ngFor="let item of codedListTasks" cdkDrag>
            <div class="task-wrapper">
              <div class="form-group">
                <div class="task-title">Task title:<input type="text" class="form-control" [(ngModel)]="item.taskTitle" (change)="renameTaskTitleOrText(item.taskId, item.taskTitle, null)"/></div>
                <div class="task-text">Task text:<input type="text" class="form-control" [(ngModel)]="item.taskText" (change)="renameTaskTitleOrText(item.taskId, null, item.taskText)"/></div>
              </div>
              <div class="options-block">
                <button type="button" class="btn btn-primary btn-sm delete-task-button" (click)="deleteTask(item.taskId)">Delete task</button>
                <button type="button" class="btn btn-secondary btn-sm">Tap me</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addTaskStatusCodedList; then addTaskButtonCodedList else inputTaskFormCodedList"></div>
      <div class="list-options">
        <button type="button" class="btn btn-primary btn-sm" (click)="deleteAllTasks(codedListTasks)">Delete all tasks</button>
      </div>
    </div>

    <div class="list-item">
      <div class="list-title d-flex justify-content-center">
        {{testingList}}
      </div>
      <div class="dividing-line"></div>

      <div class="draggable-container">
        <div
          cdkDropList
          [cdkDropListData]="testingListTasks"
          class="draggable-list"
          (cdkDropListDropped)="drop($event)">
          <div class="draggable-box" *ngFor="let item of testingListTasks" cdkDrag>
            <div class="task-wrapper">
              <div class="form-group">
                <div class="task-title">Task title:<input type="text" class="form-control" [(ngModel)]="item.taskTitle" (change)="renameTaskTitleOrText(item.taskId, item.taskTitle, null)"/></div>
                <div class="task-text">Task text:<input type="text" class="form-control" [(ngModel)]="item.taskText" (change)="renameTaskTitleOrText(item.taskId, null, item.taskText)"/></div>
              </div>
              <div class="options-block">
                <button type="button" class="btn btn-primary btn-sm delete-task-button" (click)="deleteTask(item.taskId)">Delete task</button>
                <button type="button" class="btn btn-secondary btn-sm">Tap me</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addTaskStatusTestingList; then addTaskButtonTestingList else inputTaskFormTestingList"></div>
      <div class="list-options">
        <button type="button" class="btn btn-primary btn-sm" (click)="deleteAllTasks(testingListTasks)">Delete all tasks</button>
      </div>
    </div>

    <div class="list-item">
      <div class="list-title d-flex justify-content-center">
        {{doneList}}
      </div>
      <div class="dividing-line"></div>

      <div class="draggable-container">
        <div
          cdkDropList
          [cdkDropListData]="doneListTasks"
          class="draggable-list"
          (cdkDropListDropped)="drop($event)">
          <div class="draggable-box" *ngFor="let item of doneListTasks" cdkDrag>
            <div class="task-wrapper">
              <div class="form-group">
                <div class="task-title">Task title:<input type="text" class="form-control" [(ngModel)]="item.taskTitle" (change)="renameTaskTitleOrText(item.taskId, item.taskTitle, null)"/></div>
                <div class="task-text">Task text:<input type="text" class="form-control" [(ngModel)]="item.taskText" (change)="renameTaskTitleOrText(item.taskId, null, item.taskText)"/></div>
              </div>
              <div class="options-block">
                <button type="button" class="btn btn-primary btn-sm delete-task-button" (click)="deleteTask(item.taskId)">Delete task</button>
                <button type="button" class="btn btn-secondary btn-sm">Tap me</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="addTaskStatusDoneList; then addTaskButtonDoneList else inputTaskFormDoneList"></div>
      <div class="list-options">
        <button type="button" class="btn btn-primary btn-sm" (click)="deleteAllTasks(doneListTasks)">Delete all tasks</button>
      </div>
    </div>

</div>
</div>

<ng-template #inputTaskFormTodoList>
  <div class="add-task-block">
    <form [formGroup]="createTaskFormTodoList" novalidate (ngSubmit)="addTask(todoList, createTaskFormTodoList.value.taskTitle, createTaskFormTodoList.value.taskText, createTaskFormTodoList)"
          class="d-flex align-items-center add-task-form">
      <div class="form-group">
        <input type="text" class="form-control task-title" formControlName="taskTitle" placeholder="Enter task title"/>
      </div>
      <div class="form-group">
        <input type="text" class="form-control task-text" formControlName="taskText" placeholder="Enter task text"/>
      </div>
      <div class="form-group d-flex">
        <button class="btn btn-primary btn-sm add-task-form-button" [disabled]="createTaskFormTodoList.invalid">
          Add task
        </button>
      </div>
    </form>
  <button type="button" class="add-task-button" (click)="addTaskStatusToggle(todoList)">Close form</button>
  </div>
</ng-template>

<ng-template #addTaskButtonTodoList>
  <div class="add-button">
  <button type="button" class="add-task-button" (click)="addTaskStatusToggle(todoList)">Add task</button>
  </div>
</ng-template>

<ng-template #inputTaskFormProgressList>
  <div class="add-task-block">
    <form [formGroup]="createTaskFormProgressList" novalidate (ngSubmit)="addTask(inProgressList, createTaskFormProgressList.value.taskTitle, createTaskFormProgressList.value.taskText, createTaskFormProgressList)"
          class="d-flex align-items-center add-task-form">
      <div class="form-group">
        <input type="text" class="form-control task-title" formControlName="taskTitle" placeholder="Enter task title"/>
      </div>
      <div class="form-group">
        <input type="text" class="form-control task-text" formControlName="taskText" placeholder="Enter task text"/>
      </div>
      <div class="form-group d-flex">
        <button class="btn btn-primary btn-sm add-task-form-button" [disabled]="createTaskFormProgressList.invalid">
          Add task
        </button>
      </div>
    </form>
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(inProgressList)">Close form</button>
  </div>
</ng-template>

<ng-template #addTaskButtonProgressList>
  <div class="add-button">
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(inProgressList)">Add task</button>
  </div>
</ng-template>

<ng-template #inputTaskFormCodedList>
  <div class="add-task-block">
    <form [formGroup]="createTaskFormCodedList" novalidate (ngSubmit)="addTask(codedList, createTaskFormCodedList.value.taskTitle, createTaskFormCodedList.value.taskText, createTaskFormCodedList)"
          class="d-flex align-items-center add-task-form">
      <div class="form-group">
        <input type="text" class="form-control task-title" formControlName="taskTitle" placeholder="Enter task title"/>
      </div>
      <div class="form-group">
        <input type="text" class="form-control task-text" formControlName="taskText" placeholder="Enter task text"/>
      </div>
      <div class="form-group d-flex">
        <button class="btn btn-primary btn-sm add-task-form-button" [disabled]="createTaskFormCodedList.invalid">
          Add task
        </button>
      </div>
    </form>
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(codedList)">Close form</button>
  </div>
</ng-template>

<ng-template #addTaskButtonCodedList>
  <div class="add-button">
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(codedList)">Add task</button>
  </div>
</ng-template>

<ng-template #inputTaskFormTestingList>
  <div class="add-task-block">
    <form [formGroup]="createTaskFormTestingList" novalidate (ngSubmit)="addTask(testingList, createTaskFormTestingList.value.taskTitle, createTaskFormTestingList.value.taskText, createTaskFormTestingList)"
          class="d-flex align-items-center add-task-form">
      <div class="form-group">
        <input type="text" class="form-control task-title" formControlName="taskTitle" placeholder="Enter task title"/>
      </div>
      <div class="form-group">
        <input type="text" class="form-control task-text" formControlName="taskText" placeholder="Enter task text"/>
      </div>
      <div class="form-group d-flex">
        <button class="btn btn-primary btn-sm add-task-form-button" [disabled]="createTaskFormTestingList.invalid">
          Add task
        </button>
      </div>
    </form>
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(testingList)">Close form</button>
  </div>
</ng-template>

<ng-template #addTaskButtonTestingList>
  <div class="add-button">
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(testingList)">Add task</button>
  </div>
</ng-template>

<ng-template #inputTaskFormDoneList>
  <div class="add-task-block">
    <form [formGroup]="createTaskFormDoneList" novalidate (ngSubmit)="addTask(doneList, createTaskFormDoneList.value.taskTitle, createTaskFormDoneList.value.taskText, createTaskFormDoneList)"
          class="d-flex align-items-center add-task-form">
      <div class="form-group">
        <input type="text" class="form-control task-title" formControlName="taskTitle" placeholder="Enter task title"/>
      </div>
      <div class="form-group">
        <input type="text" class="form-control task-text" formControlName="taskText" placeholder="Enter task text"/>
      </div>
      <div class="form-group d-flex">
        <button class="btn btn-primary btn-sm add-task-form-button" [disabled]="createTaskFormDoneList.invalid">
          Add task
        </button>
      </div>
    </form>
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(doneList)">Close form</button>
  </div>
</ng-template>

<ng-template #addTaskButtonDoneList>
  <div class="add-button">
    <button type="button" class="add-task-button" (click)="addTaskStatusToggle(doneList)">Add task</button>
  </div>
</ng-template>

<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Found tasks</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="modal-window" *ngIf="foundTasks != 0; then modalWindowHaveTasks else modalWindowNoTasks"></div>

        <ng-template #modalWindowHaveTasks>
          <div class="container-fluid">
              <div class="modal-tasks-block" *ngFor="let item of foundTasks">
                <div class="row modal-tasks-item">
                  <div class="modal-window-task-list-name">List name: {{item.listName}}</div>
                  <div class="modal-window-task-title">Task title: {{item.taskTitle}}</div>
                <div class="modal-window-task-text">Task text: {{item.taskText}}</div>
                </div>
              </div>
          </div>
        </ng-template>

        <ng-template #modalWindowNoTasks>
          <div class="container-fluid">
            <div class="row modal-no-tasks">No tasks found!</div>
          </div>
        </ng-template>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
